/*
 * File:   main.c
 * Author: Tyler Gamvrelis
 * 
 * Created on August 13, 2017, 6:00 PM
 * 
 * Description: Demonstration of GLCD initialization, and the fundamental
 *              graphics "function", drawing rectangles. Drawing pixels are also
 *              demonstrated as a special case of drawing rectangles.
 * 
 * Preconditions:
 *   1. GLCD is in a PIC socket
 */

/***** Includes *****/
#include <xc.h>
#include "config_bits.h"
#include "GLCD_PIC.h"

void init(void) {
    // <editor-fold defaultstate="collapsed" desc="Machine Configuration">
    /********************************* PIN I/O ********************************/
    /* Write outputs to LATx, read inputs from PORTx. Here, all latches (LATx)
     * are being cleared (set low) to ensure a controlled start-up state. */  
    LATA = 0x00;
    LATB = 0x00; 
    LATC = 0x00;
    LATD = 0x00;
    LATE = 0x00;

    /* After the states of LATx are known, the data direction registers, TRISx
     * are configured. 0 --> output; 1 --> input. Default is  1. */
    TRISA = 0xFF; // All inputs (this is the default, but is explicated here for learning purposes)
    TRISB = 0xFF;
    TRISC = 0b10000000; /* RC3 is SCK/SCL (SPI/I2C),
                         * RC4 is SDA (I2C),
                         * RC5 is SDA (SPI),
                         * RC6 and RC7 are UART TX and RX, respectively. */
    TRISD = 0b00000001; /* RD0 is the GLCD chip select (tri-stated so that it's
                         * pulled up by default),
                         * RD1 is the GLCD register select,
                         * RD2 is the character LCD RS,
                         * RD3 is the character LCD enable (E),
                         * RD4-RD7 are character LCD data lines. */
    TRISE = 0b00000100; /* RE2 is the SD card chip select (tri-stated so that
                         * it's pulled up by default).
                         * Note that the upper 4 bits of TRISE are special 
                         * control registers. Do not write to them unless you 
                         * read §9.6 in the datasheet */
    
    /************************** A/D Converter Module **************************/
    ADCON0 = 0x00;  // Disable ADC
    ADCON1 = 0b00001111; // Set all A/D ports to digital (pg. 222)
    // </editor-fold>
    
    /* Initialize GLCD. */
    initGLCD();
}

#include <stdbool.h>
#include <stdint.h>

typedef struct {
    uint32_t part[2];
} px_char;

px_char new_px_char(uint32_t a, uint32_t b) {
    px_char p;
    p.part[1] = a;
    p.part[0] = b;
    return p;
}

void print_px_char(int x, int y, px_char p) {
    uint32_t m = 0b1;
    for(int i = 0; i < 32; i++) {
        if(m & p.part[0]) glcdDrawPixel(i%5, i/5, BLACK);
        if(m & p.part[1]) glcdDrawPixel((i+32)%5, (i+32)/5, BLACK);

        m <<= 1;
    }
}

#define PX_32 new_px_char(0b00000000000000000000000000000000,0b00000000000000000000000000000000)
#define PX_33 new_px_char(0b00000000000100000000010000100001,0b00001000010000100000000000000000)
#define PX_34 new_px_char(0b00000000000000000000000000000000,0b00000000101001010010100000000000)
#define PX_35 new_px_char(0b00000000000000010100101011111010,0b10111110101001010000000000000000)
#define PX_36 new_px_char(0b00000000000100011111010010100011,0b10001010010111110001000000000000)
#define PX_37 new_px_char(0b00000000001001101010101000010001,0b00010000101010101100100000000000)
#define PX_38 new_px_char(0b00000000010110010011100100101000,0b10001010010100010000000000000000)
#define PX_39 new_px_char(0b00000000000000000000000000000000,0b00000000010000100001000000000000)
#define PX_40 new_px_char(0b00000100000100001000001000010000,0b10000100001000100001000100000000)
#define PX_41 new_px_char(0b00000001000100001000100001000010,0b00010000100000100001000001000000)
#define PX_42 new_px_char(0b00000000000000000000000000000001,0b00101010111010101001000000000000)
#define PX_43 new_px_char(0b00000000000000000000010000100111,0b11001000010000000000000000000000)
#define PX_44 new_px_char(0b00000001000100011000000000000000,0b00000000000000000000000000000000)
#define PX_45 new_px_char(0b00000000000000000000000000000111,0b11000000000000000000000000000000)
#define PX_46 new_px_char(0b00000010001110001000000000000000,0b00000000000000000000000000000000)
#define PX_47 new_px_char(0b00000000000001000010001000010001,0b00010000100010000100000000000000)
#define PX_48 new_px_char(0b00000000000100010101000110001100,0b01100011000101010001000000000000)
#define PX_49 new_px_char(0b00000000011111001000010000100001,0b00001000010100110001000000000000)
#define PX_50 new_px_char(0b00000000011111000010001000100010,0b00100001000110001011100000000000)
#define PX_51 new_px_char(0b00000000001110100011000010000011,0b10001000100010000111110000000000)
#define PX_52 new_px_char(0b00000000001000010001111101001010,0b10010100110001000010000000000000)
#define PX_53 new_px_char(0b00000000001110100011000010000100,0b11011010000100001111110000000000)
#define PX_54 new_px_char(0b00000000001110100011000110001011,0b11000010000110001011100000000000)
#define PX_55 new_px_char(0b00000000000010000100001000100001,0b00010000100010000111110000000000)
#define PX_56 new_px_char(0b00000000001110100011000110001011,0b10100011000110001011100000000000)
#define PX_57 new_px_char(0b00000000001110100011000010000111,0b10100011000110001011100000000000)
#define PX_58 new_px_char(0b00000010001110001000000000000001,0b00011100010000000000000000000000)
#define PX_59 new_px_char(0b00000001000100011000000000000001,0b00011100010000000000000000000000)
#define PX_60 new_px_char(0b00000000010000010000010000010000,0b01000100010001000100000000000000)
#define PX_61 new_px_char(0b00000000000000000001111100000000,0b00111110000000000000000000000000)
#define PX_62 new_px_char(0b00000000000001000100010001000100,0b00010000010000010000010000000000)
#define PX_63 new_px_char(0b00000000000100000000010000100010,0b00100001000110001011100000000000)
#define PX_64 new_px_char(0b00000000011110000010110110101101,0b01110011000110001011100000000000)
#define PX_65 new_px_char(0b00000000000000100011000110001111,0b11100011000110001010100010000000)
#define PX_66 new_px_char(0b00000000000000011111001010010100,0b10011101001010010100100111100000)
#define PX_67 new_px_char(0b00000000000000011101000100001000,0b01000010000100001100010111000000)
#define PX_68 new_px_char(0b00000000000000011111001010010100,0b10100101001010010100100111100000)
#define PX_69 new_px_char(0b00000000000000111110000100001000,0b01011110000100001000011111100000)
#define PX_70 new_px_char(0b00000000000000000010000100001000,0b01011110000100001000011111100000)
#define PX_71 new_px_char(0b00000000000000011101000110001110,0b01000010000100001100010111000000)
#define PX_72 new_px_char(0b00000000000000100011000110001100,0b01111111000110001100011000100000)
#define PX_73 new_px_char(0b00000000000000011100010000100001,0b00001000010000100001000111000000)
#define PX_74 new_px_char(0b00000000000000001100100101000010,0b00010000100001000010001110000000)
#define PX_75 new_px_char(0b00000000000000100011000101001001,0b01000110010101001100011000100000)
#define PX_76 new_px_char(0b00000000000000111110000100001000,0b01000010000100001000010000100000)
#define PX_77 new_px_char(0b00000000000000100011000110001100,0b01101011010111011100011000100000)
#define PX_78 new_px_char(0b00000000000000100011000111001110,0b01101011010110011100111000100000)
#define PX_79 new_px_char(0b00000000000000011101000110001100,0b01100011000110001100010111000000)
#define PX_80 new_px_char(0b00000000000000000010000100001000,0b01011111000110001100010111100000)
#define PX_81 new_px_char(0b00000000010000011101010110001100,0b01100011000110001100010111000000)
#define PX_82 new_px_char(0b00000000000000100011000101001001,0b01011111000110001100010111100000)
#define PX_83 new_px_char(0b00000000000000011101000110000100,0b00011100000100001100010111000000)
#define PX_84 new_px_char(0b00000000000000001000010000100001,0b00001000010000100001001111100000)
#define PX_85 new_px_char(0b00000000000000011101000110001100,0b01100011000110001100011000100000)
#define PX_86 new_px_char(0b00000000000000001000010001010010,0b10100011000110001100011000110001)
#define PX_87 new_px_char(0b00000000000000010101010110101101,0b01101011000110001100011000110001)
#define PX_88 new_px_char(0b00000000000000100011000101010010,0b10001000101001010100011000100000)
#define PX_89 new_px_char(0b00000000000000001000010000100001,0b00001000101001010100011000100000)
#define PX_90 new_px_char(0b00000000000000111110000100010000,0b10001000100001000100001111100000)

void main(void) {
    init();
    
    /* Fill screen with rainbow colors. */
    glcdDrawRectangle(0, 18, 0, GLCD_SIZE_VERT, RED);
    glcdDrawRectangle(18, 36, 0, GLCD_SIZE_VERT, ORANGE);
    glcdDrawRectangle(36, 54, 0, GLCD_SIZE_VERT, YELLOW);
    glcdDrawRectangle(54, 72, 0, GLCD_SIZE_VERT, GREEN);
    glcdDrawRectangle(72, 90, 0, GLCD_SIZE_VERT, BLUE);
    glcdDrawRectangle(90, 108, 0, GLCD_SIZE_VERT, INDIGO);
    glcdDrawRectangle(108, 128, 0, GLCD_SIZE_VERT, VIOLET);

    px_char letter = PX_90;
    
    while(1) {
        print_px_char(0, 0, letter);
    }
    
    return;
}
